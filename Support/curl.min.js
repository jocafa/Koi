/**
 * curl (cujo resource loader)
 *
 * (c) copyright 2011, unscriptable.com / John Hann
 * Licensed under the MIT License at:
 * 		http://www.opensource.org/licenses/mit-license.php
 *
 */(function(a,b,c){function x(a,b){return l.call(a).indexOf("[object "+b)==0}function y(a,b){function c(b){var c;if(b in a)return a[b].charAt(0)!="."?c=I(a.path,a[b]):c=Q(a[b],a.path),J(c)}return x(a,"String")&&(a=J(a),a={name:a,path:a,main:v.main,lib:v.lib}),a.path=a.path||"",a.lib=c("lib"),a.main=c("main"),a}function z(a){var b,c,d,e=[];f=a.baseUrl||"",a.debug&&(w=!0,V.cache=i,V.cfg=a,V.undefine=function(a){delete i[a]});var j=a.paths;for(b in j)c=J(b.replace("!","!/")),d=h[c]={path:J(j[b])},d.specificity=(d.path.match(q)||[]).length,e.push(c);var k=a.packages;for(b in k)c=J(k[b].name||b),d=h[c]=y(k[b],c),d.specificity=(d.path.match(q)||[]).length,e.push(c);s=new RegExp("^("+e.sort(function(a,b){return h[a].specificity<h[b].specificity}).join("|").replace(/\//g,"\\/")+")(?=\\/|$)"),g=a.pluginPath||g}function A(){}function B(a){function b(a){return L(K(Q(a,c)),f)}var c=a.substr(0,a.lastIndexOf("/")),d={baseName:c},e={},g=function(a,b){return U(a,b||A,d)};return d.vars={exports:e,module:{id:Q(a,c),uri:b(a),exports:e}},w&&(g.curl=V),d.require=d.vars.require=g,g.toUrl=b,d}function C(){}function D(a){C.prototype=a;var b=new C;return C.prototype=m,b}function E(a){var b;return b=a?c.plugins&&c.plugins[a]:c,D(b)}function F(){function c(a,c){b.push([a,c])}function d(a){f(!0,a)}function e(a){f(!1,a)}function f(a,f){c=a?function(a,b){a&&a(f)}:function(a,b){b&&b(f)},d=e=function(){throw new Error("Promise already completed.")};var g,h,i=0;while(g=b[i++])h=g[a?0:1],h&&h(f)}var a=this,b=[];this.then=function(b,d){return c(b,d),a},this.resolve=function(b){a.resolved=b,d(b)},this.reject=function(b){a.rejected=b,e(b)}}function G(a){F.apply(this),this.name=a}function H(a){return a.charAt(a.length-1)=="/"}function I(a,b){return(!a||H(a)?a:a+"/")+b}function J(a){return H(a)?a.substr(0,a.length-1):a}function K(a,b){function f(a){d=a.replace(s,function(b){return c=h[b]||{},e=!0,c.main&&b==a?c.main:c.lib?c.lib:c.path||""})}var c,d,e;return b&&f(b+"!/"+a),e||f(a),d}function L(a,b,c){return(b&&!o.test(a)?I(b,a):a)+(c&&!r.test(a)?".js":"")}function M(c,d,f){function h(b){b=b||a.event;if(b.type==="load"||t[this.readyState])delete k[c.name],this.onload=this[u]=this.onerror=null,d(g)}function i(a){f(new Error("Syntax error or http error: "+c.url))}var g=b.createElement("script");g.type="text/javascript",g.onload=g[u]=h,g.onerror=i,g.charset=c.charset||"utf-8",g.async=!0,g.src=c.url,k[c.name]=g,e.insertBefore(g,e.firstChild)}function N(a){var b,c,d,e,f=a.length;return d=a[f-1],e=x(d,"Function"),f==2?x(a[0],"Array")?c=a[0]:b=a[0]:f==3&&(b=a[0],c=a[1]),!c&&e&&d.length>0&&(c=["require","exports","module"]),{name:b,deps:c||[],res:e?d:function(){return d}}}function O(a,b,c){w&&console&&console.log("curl: resolving",a.name);var d=B(a.baseName||a.name);S(a,b.deps,d,function(c){try{var e=b.res.apply(d.vars.exports,c)||d.vars.exports;w&&console&&console.log("curl: defined",a.name,e.toString().substr(0,50).replace(/\n/," "))}catch(f){a.reject(f)}a.resolve(e)},a.reject)}function P(a,b){return M(a,function(){var c=j;j=m,a.useNet!==!1&&(c?c.ex?a.reject(new Error(c.ex.replace("${url}",a.url))):O(a,c,b):a.reject(new Error("define() not found or duplicates found: "+a.url)))},a.reject),a}function Q(a,b){return a.replace(p,function(a,c,d){return(d?b.substr(0,b.lastIndexOf("/")):b)+"/"})}function R(a,b){var c,d,e,h,j,k;d=a.indexOf("!");if(d>=0){e=a.substr(0,d),h=a.substr(d+1);var l=K(e),m=l.indexOf("/");m<0&&(l=K(I(g,l)));var n=i[e];n||(n=i[e]=new G(e),n.url=L(l,f,!0),n.baseName=l,P(n,b)),b=B(b.baseName),b.require.toUrl=function(a){var b,c;return c=K(a,e),L(c,f)},k=E(e)||{};function o(a){return Q(a,b.baseName)}j=new G(a),n.then(function(f){var g;h=a.substr(d+1),"normalize"in f?h=f.normalize(h,o,k):h=o(h),c=e+"!"+h,g=i[c];if(!g){g=new G(c),h&&!f.dynamic&&(i[c]=g);var l=g.resolve;l.resolve=l,l.reject=g.reject,f.load(h,b.require,l,k)}g.then(j.resolve,j.reject)},j.reject)}else h=c=Q(a,b.baseName),j=i[h],j||(j=i[h]=new G(h),j.url=L(K(h),f,!0),P(j,b));return j}function S(a,b,c,d,e){var f=[],g=b.length,h=g,i=!1;for(var j=0;j<h&&!i;j++)(function(a,b){b in c.vars?(f[a]=c.vars[b],g--):R(b,c).then(function(b){f[a]=b,--g==0&&(i=!0,d(f))},function(a){i=!0,e(a)})})(j,b[j]);g==0&&!i&&d(f)}function T(){var b;if(!x(a.opera,"Opera"))for(var c in k)if(k[c].readyState=="interactive"){b=c;break}return b}function U(a,b,c){if(x(a,"String")){var d=i[a],e=d&&d.resolved;if(e===m)throw new Error("Module is not already resolved: "+a);return e}S(null,a,c,function(a){b.resolve?b.resolve(a):b.apply(null,a)},function(a){if(b.reject)b.reject(a);else throw a})}function V(){var a=n.call(arguments),b,d,e;x(a[0],"Object")&&(c=a.shift(),z(c)),d=[].concat(a[0]),b=a[1],e=B("");var f=new F,g={};return g.then=function(a,b){return f.then(function(b){a&&a.apply(null,b)},function(a){if(b)b(a);else throw a}),g},g.next=function(a,b){var c=f;return f=new F,c.then(function(){e.require(a,f,e)},function(a){f.reject(a)}),b&&f.then(function(a){b.apply(this,a)}),g},b&&g.then(b),e.require(d,f,e),g}function W(){var a=N(arguments),b=a.name;b==null&&(j!==m?j={ex:"Multiple anonymous defines found in ${url}."}:(b=T())||(j=a));if(b!=null){var c=i[b];c||(c=i[b]=new G(b)),c.useNet=!1,"resolved"in c||O(c,a,B(b))}}var d="0.5.3",e=b.head||b.getElementsByTagName("head")[0],f,g="curl/plugin",h={},i={},j,k={},l={}.toString,m,n=[].slice,o=/^\/|^[^:]+:\/\//,p=/^(\.)(\.)?(\/|$)/,q=/\//,r=/\?/,s,t={loaded:1,interactive:1,complete:1},u="onreadystatechange",v={main:"./lib/main",lib:"./lib"},w,X=x(c,"Function");X||z(c);var Y,Z;Y=c.apiName||"curl",Z=c.apiContext||a,Z[Y]=V,i[Y]=new G(Y),i[Y].resolve(V),a.define=V.define=W,V.version=d,W.amd={plugins:!0}})(this,document,this.curl||{}),function(a,b){function n(){g=!0,clearTimeout(l);while(j=k.pop())j();f&&(b[c]="complete");var a;while(a=e.shift())a()}function p(){if(!b.body)return!1;o||(o=b.createTextNode(""));try{return b.body.removeChild(b.body.appendChild(o)),o=m,!0}catch(a){return!1}}function q(a){var e;return e=d[b[c]]&&p(),!g&&e&&n(),e}function r(){q(),g||(l=setTimeout(r,h))}var c="readyState",d={loaded:1,interactive:1,complete:1},e=[],f=typeof b[c]!="string",g=!1,h=10,i,j,k=[],l,m,o;"addEventListener"in a?i=function(a,b){return a.addEventListener(b,q,!1),function(){a.removeEventListener(b,q,!1)}}:i=function(a,b){return a.attachEvent("on"+b,q),function(){a.detachEvent(b,q)}},b&&(q()||(k=[i(a,"load"),i(b,"readystatechange"),i(a,"DOMContentLoaded")],l=setTimeout(r,h))),define(function(){function a(a){g?a():e.push(a)}return a.then=a,a.amd=!0,a})}(this,document),define(["curl/domReady"],function(a){return{load:function(b,c,d,e){a(d)}}}),function(global,doc){function loadScript(a,b,c){function f(c){c=c||global.event;if(c.type=="load"||readyStates[e.readyState])e.onload=e[orsc]=e.onerror="",!a.test||testGlobalVar(a.test)?b(e):g()}function g(b){e.onload=e[orsc]=e.onerror="",c&&c(new Error("Script error or http error: "+a.url))}function h(){e.onload&&readyStates[e.readyState]?f({}):e.onload&&d<new Date?g():setTimeout(h,10)}var d,e;d=(new Date).valueOf()+(a.timeout||300)*1e3,e=doc.createElement("script"),c&&a.test&&setTimeout(h,10),e.type=a.mimetype||"text/javascript",e.onload=e[orsc]=f,e.onerror=g,e.charset=a.charset||"utf-8",e.async=a.async,e.src=a.url,head.insertBefore(e,head.firstChild)}function fetch(a,b){loadScript(a,function(a){var c=queue.shift();waitForOrderedScript=queue.length>0,c&&fetch.apply(null,c),b.resolve(a)},function(a){b.reject(a)})}function testGlobalVar(varName){try{return eval("global."+varName),!0}catch(ex){return!1}}"use strict";var queue=[],supportsAsyncFalse=doc.createElement("script").async==!0,readyStates={loaded:1,interactive:1,complete:1},orsc="onreadystatechange",head=doc.head||doc.getElementsByTagName("head")[0],waitForOrderedScript;define({load:function(a,b,c,d){var e,f,g,h,i,j;e=a.indexOf("!order")>0,f=a.indexOf("!test="),g=f>0&&a.substr(f+6),h="prefetch"in d?d.prefetch:!0,a=e||f>0?a.substr(0,a.indexOf("!")):a,i={name:a,url:b.toUrl(a),async:!e,order:e,test:g,timeout:d.timeout},j=c.resolve?c:{resolve:function(a){c(a)},reject:function(a){throw a}},e&&!supportsAsyncFalse&&waitForOrderedScript?(queue.push([i,j]),h&&(i.mimetype="text/cache",loadScript(i,function(a){a.parentNode.removeChild(a)},!1),i.mimetype="")):(waitForOrderedScript=waitForOrderedScript||e,fetch(i,j))}})}(this,document),function(a){function f(a,b){return a.lastIndexOf(".")<=a.lastIndexOf("/")?a+"."+b:a}function g(a,c){var d=a[b]("link");return d.rel="stylesheet",d.type="text/css",d.href=c,d}function h(a,b){return a.replace(d,b+"//")}"use strict";var b="createElement",c=a.document,d=/^\/\//,e;c&&(e=c.head||(c.head=c.getElementsByTagName("head")[0])),define({load:function(a,b,d,i){var j,k,l;j=b.toUrl(f(a,"css")),l="fixSchemalessUrls"in i?i.fixSchemalessUrls:c.location.protocol,j=l?h(j,l):j,k=g(c,j),e.appendChild(k),d(k.sheet||k.styleSheet)}})}(this),define(function(){function c(){if(typeof XMLHttpRequest!="undefined")c=function(){return new XMLHttpRequest};else{var b=c=function(){throw new Error("getXhr(): XMLHttpRequest not available")};while(a.length>0&&c===b)(function(a){try{new ActiveXObject(a),c=function(){return new ActiveXObject(a)}}catch(b){}})(a.shift())}return c()}function d(a,b,d){var e=c();e.open("GET",a,!0),e.onreadystatechange=function(a){e.readyState===4&&(e.status<400?b(e.responseText):d(new Error("fetchText() failed. status: "+e.statusText)))},e.send(null)}function e(a,b){return a.lastIndexOf(".")<=a.lastIndexOf("/")?a+"."+b:a}function f(a){console&&(console.error?console.error(a):console.log(a.message))}function g(a){var b={34:'\\"',13:"\\r",12:"\\f",10:"\\n",9:"\\t",8:"\\b"};return a.replace(/(["\n\f\t\r\b])/g,function(a){return b[a.charCodeAt(0)]})}var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b={};return{load:function(a,b,c,e){var g=c.resolve||c,h=c.reject||f;d(b.toUrl(a),g,h)},build:function(a,c,d){return function f(d,f,h){var i,j,k,l;i=h.toUrl(e(f,"html")),j=h.toAbsMid(f),j in b||(b[j]=!0,k=g(c(i)),l='define("'+d+"!"+j+'", function () {\n'+'\treturn "'+k+'";\n'+"});\n",a(l))}}}}),define(function(){})